<!DOCTYPE html>
<html lang="en">
    <head>
        <base href="/" />
        <meta charset="utf-8">
        <meta name="theme-color" content="#000000">
        <meta name="format-detection" content="telephone=no" />
        <title>proxy3</title>
    </head>
    <body>
        <script type="text/javascript">
            const menus = {
                "26": {
                    "child": {
                        "0": {
                            "child": {
                                "1": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.qualification.application",
                                            "icon": null,
                                            "id": 10195,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": true,
                                            "level": 4,
                                            "name": "资质审核",
                                            "parent": 10194,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/qualification/application"
                                        }
                                    },
                                    "code": "supplier#app.qualification.apply",
                                    "icon": null,
                                    "id": 10194,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "资质申请",
                                    "parent": 10193,
                                    "sortNum": 1,
                                    "url": "http://supplier.console.saas.weimobqa.com/supplier/#/app/9145/21180145/qualification/apply"
                                }
                            },
                            "code": "supplier#app.qualification",
                            "icon": null,
                            "id": 10193,
                            "isBlank": false,
                            "isChecked": true,
                            "isShow": true,
                            "level": 2,
                            "name": "供货商入驻",
                            "parent": 8775,
                            "sortNum": 0,
                            "url": null
                        },
                        "1": {
                            "child": {
                                "1": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.goods.detail",
                                            "icon": "",
                                            "id": 8778,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "商品详情",
                                            "parent": 8777,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/goods/detail"
                                        },
                                        "2": {
                                            "child": null,
                                            "code": "supplier#app.goods.edit",
                                            "icon": "",
                                            "id": 8779,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "商品编辑",
                                            "parent": 8777,
                                            "sortNum": 2,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/goods/edit"
                                        },
                                        "3": {
                                            "child": null,
                                            "code": "supplier#app.goods.import",
                                            "icon": "",
                                            "id": 8780,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "导入商品",
                                            "parent": 8777,
                                            "sortNum": 3,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/goods/import"
                                        }
                                    },
                                    "code": "supplier#app.goods.list",
                                    "icon": "",
                                    "id": 8777,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "商品列表",
                                    "parent": 8776,
                                    "sortNum": 1,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/goods/list"
                                },
                                "2": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.goods.distribution.create",
                                            "icon": "",
                                            "id": 8782,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "新建分销模板",
                                            "parent": 8781,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/distribution/create"
                                        },
                                        "2": {
                                            "child": null,
                                            "code": "supplier#app.goods.distribution.edit",
                                            "icon": "",
                                            "id": 8783,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "编辑分销模板",
                                            "parent": 8781,
                                            "sortNum": 2,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/distribution/create"
                                        }
                                    },
                                    "code": "supplier#app.goods.distribution",
                                    "icon": "",
                                    "id": 8781,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "分销模板",
                                    "parent": 8776,
                                    "sortNum": 2,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/distribution/list"
                                },
                                "3": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.goods.freight.template.create",
                                            "icon": "",
                                            "id": 8785,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "新建运费模板",
                                            "parent": 8784,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/freight/template/add"
                                        },
                                        "2": {
                                            "child": null,
                                            "code": "supplier#app.goods.freight.template.edit",
                                            "icon": "",
                                            "id": 8786,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "编辑运费模板",
                                            "parent": 8784,
                                            "sortNum": 2,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/freight/template/edit"
                                        }
                                    },
                                    "code": "supplier#app.goods.freight.template.list",
                                    "icon": "",
                                    "id": 8784,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "运费模板",
                                    "parent": 8776,
                                    "sortNum": 3,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/freight/template/list"
                                }
                            },
                            "code": "",
                            "icon": "",
                            "id": 8776,
                            "isBlank": false,
                            "isChecked": true,
                            "isShow": true,
                            "level": 2,
                            "name": "商品管理",
                            "parent": 8775,
                            "sortNum": 1,
                            "url": ""
                        },
                        "2": {
                            "child": {
                                "1": {
                                    "child": null,
                                    "code": "supplier#app.stock.list",
                                    "icon": "",
                                    "id": 8788,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "库存列表",
                                    "parent": 8787,
                                    "sortNum": 1,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/stock"
                                }
                            },
                            "code": "",
                            "icon": "",
                            "id": 8787,
                            "isBlank": false,
                            "isChecked": true,
                            "isShow": true,
                            "level": 2,
                            "name": "库存管理",
                            "parent": 8775,
                            "sortNum": 2,
                            "url": ""
                        },
                        "3": {
                            "child": {
                                "1": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.order.deliver",
                                            "icon": "",
                                            "id": 8791,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "批量发货",
                                            "parent": 8790,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/order/deliver"
                                        },
                                        "2": {
                                            "child": null,
                                            "code": "supplier#app.order.detail",
                                            "icon": "",
                                            "id": 8792,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "订单详情",
                                            "parent": 8790,
                                            "sortNum": 2,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/order/detail"
                                        }
                                    },
                                    "code": "supplier#app.order.list",
                                    "icon": "",
                                    "id": 8790,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "订单列表",
                                    "parent": 8789,
                                    "sortNum": 1,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/order/list"
                                },
                                "2": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "supplier#app.permission.detail",
                                            "icon": "",
                                            "id": 8794,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "维权订单详情",
                                            "parent": 8793,
                                            "sortNum": 1,
                                            "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/permission/detail"
                                        }
                                    },
                                    "code": "supplier#app.permission",
                                    "icon": "",
                                    "id": 8793,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "维权订单",
                                    "parent": 8789,
                                    "sortNum": 2,
                                    "url": "http://supplier.console.saas.weimobqa.com/#/app/9145/21180145/permission/list"
                                }
                            },
                            "code": "",
                            "icon": "",
                            "id": 8789,
                            "isBlank": false,
                            "isChecked": true,
                            "isShow": true,
                            "level": 2,
                            "name": "订单管理",
                            "parent": 8775,
                            "sortNum": 3,
                            "url": ""
                        },
                        "4": {
                            "child": {
                                "1": {
                                    "child": {
                                        "1": {
                                            "child": null,
                                            "code": "foundation#app.finance.accountedit",
                                            "icon": "",
                                            "id": 8797,
                                            "isBlank": false,
                                            "isChecked": true,
                                            "isShow": false,
                                            "level": 4,
                                            "name": "提现账户修改",
                                            "parent": 8796,
                                            "sortNum": 1,
                                            "url": "http://basis.console.saas.weimobqa.com/#/app/9145/21180145/finance/accountedit"
                                        }
                                    },
                                    "code": "foundation#app.finance.account",
                                    "icon": "",
                                    "id": 8796,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "我的账户",
                                    "parent": 8795,
                                    "sortNum": 1,
                                    "url": "http://basis.console.saas.weimobqa.com/#/app/9145/21180145/finance/account"
                                },
                                "2": {
                                    "child": null,
                                    "code": "foundation#app.finance.dealport",
                                    "icon": "",
                                    "id": 8798,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "交易订单",
                                    "parent": 8795,
                                    "sortNum": 2,
                                    "url": "http://basis.console.saas.weimobqa.com/#/app/9145/21180145/finance/dealport"
                                },
                                "3": {
                                    "child": null,
                                    "code": "foundation#app.finance.refund",
                                    "icon": "",
                                    "id": 8799,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "退款订单",
                                    "parent": 8795,
                                    "sortNum": 3,
                                    "url": "http://basis.console.saas.weimobqa.com/#/app/9145/21180145/finance/refund"
                                },
                                "4": {
                                    "child": null,
                                    "code": "foundation#app.finance.withdrawport",
                                    "icon": "",
                                    "id": 8800,
                                    "isBlank": false,
                                    "isChecked": true,
                                    "isShow": true,
                                    "level": 3,
                                    "name": "提现订单",
                                    "parent": 8795,
                                    "sortNum": 4,
                                    "url": "http://basis.console.saas.weimobqa.com/#/app/9145/21180145/finance/withdrawport"
                                }
                            },
                            "code": "",
                            "icon": "",
                            "id": 8795,
                            "isBlank": false,
                            "isChecked": true,
                            "isShow": true,
                            "level": 2,
                            "name": "财务报表",
                            "parent": 8775,
                            "sortNum": 4,
                            "url": ""
                        }
                    },
                    "code": "supplier#app.qualification.apply",
                    "icon": "icon-fenxiao",
                    "id": 8775,
                    "isBlank": false,
                    "isChecked": true,
                    "isShow": true,
                    "level": 1,
                    "name": "供货",
                    "parent": 0,
                    "sortNum": 26,
                    "url": "http://supplier.console.saas.weimobqa.com/supplier/#/app/9145/21180145/qualification/apply"
                },
            }

            const location2 = {
                hash: "#/app/9145/21180145/purchase/list",
                host: "localhost:8000",
                hostname: "localhost",
                href: "http://localhost:8000/#/app/9145/21180145/purchase/list",
                origin: "http://localhost:8000",
                pathname: "/",
                port: "8000",
                protocol: "http:"
            }

        function obTranverse(obTreeData, processer, format = {}) {
            if (!obTreeData) {
                return;
            }
            const { children = 'children' } = format;
            const stock = Object.values(obTreeData);
            let current = null;
            // eslint-disable-next-line no-cond-assign
            while ((current = stock.pop())) {
                processer(current);
                const childs = current[children];
                if (childs) {
                    stock.push(...Object.values(childs));
                }
            }
        }


        function getMenuData(menus = {}) {
            const { origin, pathname } = location2;
            obTranverse(
                menus,
                item => {
                    let { url } = item;
                    url = url || ''
                    const path = url.split('#')[1];
                    if (path) {
                    // eslint-disable-next-line
                    item.url = `${origin + pathname}#${path}`;
                    }
                },
                { children: 'child' }
            );
            return Object.values(menus).filter(item => item.isShow);
        }

        const m = getMenuData(menus)
        // console.log(m)
        const pathname = "/app/9145/21180145/stock"
        const formatPathName = string => {
            const reg = /(\/app(\/\d+){2}(\/[a-z]+)+)(\/\d+)*/;
            const ret = string.match(reg);
            return ret[1];
        };

        const getMenuLevel = (array, target) => {
            const loop = arr =>{
                console.log(arr)
                return arr.reduce((prev, cur) => {
                    if (cur.url && cur.url.includes(formatPathName(target))) {
                        console.log('1',cur)
                        prev = true;
                    } else if (cur.child && loop(Object.values(cur.child))) {
                        console.log('2',cur)
                        prev = true;
                    }
                    return prev;
                }, false);
            }
                

            const result = [];
            let subArray = array;
            do {
                const [matched] = subArray.filter(
                item =>
                    (item.url && item.url.includes(formatPathName(target))) ||
                    loop(Object.values(item.child || {}))
                );

                if (!matched) break;
                result.push(matched);
                subArray = Object.values(matched.child || {});
            } while (subArray.length);
            return result;
        };

        // console.log(formatPathName(pathname))
        const ret = getMenuLevel(Object.values(menus),pathname)
        console.log(ret)
        </script>
    </body>
</html>
